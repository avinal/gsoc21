<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Coding Week 9 Meeting | New Buildsystem and CI/CD
</title>
  <link rel="canonical" href="https://gsoc.avinal.space/posts/report/meeting-10.html">

  <link rel="apple-touch-icon" href="https://gsoc.avinal.space/apple-touch-icon.png" sizes="180x180">
  <link rel="icon" type="image/png" href="https://gsoc.avinal.space/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="https://gsoc.avinal.space/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="https://gsoc.avinal.space/site.webmanifest">
  <meta name="theme-color" content="#333333">

  <link rel="stylesheet" href="https://gsoc.avinal.space/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://gsoc.avinal.space/theme/css/all.css">
  <link rel="stylesheet" href="https://gsoc.avinal.space/theme/css/pygments/manni.min.css">
  <link rel="stylesheet" href="https://gsoc.avinal.space/theme/css/theme.css">
  <link rel="stylesheet" href="https://gsoc.avinal.space/theme/css/space.css">

<link rel="alternate" type="application/atom+xml" title="Full Atom Feed" href="https://gsoc.avinal.space/feeds/all.atom.xml">
<link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
  href="https://gsoc.avinal.space/feeds/report.atom.xml">
<meta name="description" content="This week I worked on CMake testing configuration. Most of the time was spent understanding the previous testing architecture.">


</head>

<body style="font-family:Overpass Mono,monospace;">
  <header class="header star">
    <div id='stars'></div>
    <div id='stars2'></div>
    <div id='stars3'></div>
    <div class="container">
<div class="row">
  <div class="col-sm-12">
    <h1 class="title" style="font-family: ExodarOut;font-weight: lighter;"><a href="https://gsoc.avinal.space/">New Buildsystem and CI/CD</a>
    </h1>
    <p class="text-muted">A GSoC project by Avinal Kumar</p>
    <ul class="list-inline">
      <li class="list-inline-item"><a href="https://avinal.space" target="_blank">about me</a></li>
      <li class="list-inline-item text-muted">|</li>
      <li class="list-inline-item"><a href="https://gsoc.avinal.space/pages/project.html">Project</a></li>
      <li class="list-inline-item text-muted">|</li>
      <li class="list-inline-item"><a href="https://gsoc.avinal.space/pages/timeline.html">Timeline</a></li>
      <li class=" list-inline-item text-muted">|</li>
      <li class="list-inline-item"><a class="fab fa-google" href="https://summerofcode.withgoogle.com/projects/#4535841440923648" target="_blank"></a></li>
      <li class="list-inline-item"><a class="fab fa-github" href="https://github.com/avinal/fossology/tree/avinal/feat/cmake-buildsystem" target="_blank"></a></li>
      <li class="list-inline-item"><a class="fab fa-linkedin" href="https://www.linkedin.com/in/avinal/" target="_blank"></a></li>
      <li class="list-inline-item"><a class="fa fa-envelope" href="mailto:blog@avinal.space" target="_blank"></a></li>
    </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h2 style="font-weight:600;">Coding Week 9 Meeting
</h2>
      <hr>
<article class="article">
  <header>
    <ul class="list-inline">
      <li class="list-inline-item text-muted" title="2021-08-06T22:47:00+05:30">
        <i class="fas fa-clock"></i>
        Fri 06 August 2021
      </li>
      <li class="list-inline-item">
        <i class="fas fa-folder-open"></i>
        <a href="https://gsoc.avinal.space/category/report.html">report</a>
      </li>
      <li class="list-inline-item">
        <i class="fas fa-tag"></i>
        <a href="https://gsoc.avinal.space/tag/gsoc.html">#gsoc</a>,         <a href="https://gsoc.avinal.space/tag/fossology.html">#FOSSology</a>      </li>
    </ul>
  </header>
  <div class="content">
    <div class="alert alert-info" role="alert">This week I worked on CMake testing configuration. Most of the time was spent understanding the previous testing architecture.</div><div class="section" id="attendees">
<h2>Attendees</h2>
<ul class="simple">
<li><a class="reference external" href="https://github.com/GMishx">Gaurav Mishra</a></li>
<li><a class="reference external" href="https://github.com/ag4ums">Anupam Ghosh</a></li>
<li><a class="reference external" href="https://github.com/avinal">Avinal Kumar</a></li>
</ul>
</div>
<div class="section" id="week-9-progress">
<h2>Week 9 Progress</h2>
<div class="alert alert-success" role="alert">
<ul><li>Initial CMake testing configuration added.</li>
<li>Few tests working, e.g copyright, nomos</li>
<li>Improved packaging configurations</li>
<li>To test the current progress, follow the instructions <a href="https://github.com/avinal/FOSSology/wiki#test-the-new-system-only-gcc-with-make-and-ninja-tested-for-now">here</a></li>
</ul>
</div></div>
<div class="section" id="discussions">
<h2>Discussions</h2>
<ul>
<li><p class="first"><strong>Is this a necessity that tests must be run as the fossy user? Because when I run tests as me they as for permissions. But proceeds as the fossy user.</strong></p>
<ul class="simple">
<li>No this is not required and this should not happen. They run under fossy as they sometimes require writing into /srv/fossology. But if they can run under other users that is an enhancement.</li>
</ul>
</li>
<li><p class="first"><strong>I am getting a lot of install issues in C/C++ agent tests?</strong></p>
<div class="highlight"><pre><span></span>Start<span class="w"> </span><span class="m">3</span>:<span class="w"> </span>delagent_unit_test

<span class="m">3</span>:<span class="w"> </span>Test<span class="w"> </span>command:<span class="w"> </span>/home/avinal/Documents/my_git/fossology/build/src/delagent/agent_tests/test_delagent
<span class="m">3</span>:<span class="w"> </span>Test<span class="w"> </span>timeout<span class="w"> </span>computed<span class="w"> </span>to<span class="w"> </span>be:<span class="w"> </span><span class="m">10000000</span>
<span class="m">3</span>:<span class="w"> </span>install:<span class="w"> </span>cannot<span class="w"> </span>stat<span class="w"> </span><span class="s1">&#39;/home/avinal/Documents/my_git/fossology/build/src/delagent/agent_tests/..//../../install/defconf/Db.conf&#39;</span>:<span class="w"> </span>No<span class="w"> </span>such<span class="w"> </span>file<span class="w"> </span>or<span class="w"> </span>directory
<span class="m">3</span>:<span class="w"> </span>install:<span class="w"> </span>cannot<span class="w"> </span>stat<span class="w"> </span><span class="s1">&#39;/home/avinal/Documents/my_git/fossology/build/src/delagent/agent_tests/..//VERSION&#39;</span>:<span class="w"> </span>No<span class="w"> </span>such<span class="w"> </span>file<span class="w"> </span>or<span class="w"> </span>directory
<span class="m">3</span>:<span class="w"> </span>sh:<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>../../../testing/db/createTestDB.php:<span class="w"> </span>not<span class="w"> </span>found
<span class="m">3</span>:<span class="w"> </span>Failed<span class="w"> </span>to<span class="w"> </span>run<span class="w"> </span>../../../testing/db/createTestDB.php<span class="w"> </span>-c<span class="w"> </span>/home/avinal/Documents/my_git/fossologbuild/src/delagent/agent_tests/testconf<span class="w"> </span>-e,<span class="w"> </span><span class="nb">exit</span><span class="w"> </span>code<span class="w"> </span>is:127<span class="w"> </span>.
<span class="m">3</span>/8<span class="w"> </span>Test<span class="w"> </span><span class="c1">#3: delagent_unit_test ...............***Failed    0.02 sec</span>
</pre></div>
<ul class="simple">
<li>Not sure about the reason. I was suspecting Makefile but since they are gone now, I think PHP files are calling some shell commands causing this.</li>
</ul>
</li>
<li><p class="first"><strong>Suggestions/Changes from Gaurav for fixing tests.</strong></p>
<ul class="simple">
<li>For clib-tests, it needs to be called from PHP file (via PHPUnit) as it requires setting up a dummy repo. Check the <code>src/lib/c/test/Makefile</code></li>
<li>For missing services.xml, the test cases include <code>src/lib/php/common-container.php</code> which loads the file. It expects it to be in current dir. Can be solved in two ways<ul>
<li>Create another common-container.php just for test cases with correct paths.</li>
<li>Edit the current file and take the help of environment variables. For example, if a test variable is exported in env, find the XML relative to it otherwise continue as normal and this variable can be exported by CMake during the test.</li>
</ul>
</li>
<li>Scheduler tests do need <code>fossology_testconfig</code> from Makefile.deps which set up the srv and create test configurations, DB, etc.<ul>
<li>Another shell script can be written to do all that and call it from CMake. The PHP file called makes everything required in /tmp so not an issue.</li>
<li>The locations like <code>LOG_DIR, FOSSDB_CONF</code>, etc. in CMakeLists.txt can be changed to some other values. I am guessing this is the reason you were asked for the fossy password.</li>
</ul>
</li>
<li>File <code>src/copyright/agent_tests/Functional/cli_test.sh</code> needs to be edited to take paths relative to build dir. It can also be made into a .in file which is generated from CMake? So every path can easily be updated.</li>
<li>For PHP agents with missing version.php issue, there is a hack possible<ul>
<li>Check <a class="reference external" href="https://www.php.net/manual/en/function.set-include-path.php">https://www.php.net/manual/en/function.set-include-path.php</a></li>
<li>Another hack will be to use soft links for version.php in the source.</li>
</ul>
</li>
<li>Other PHP issues like <code>PHP Fatal error: Uncaught Error: Class 'Fossology\Lib\Agent\Agent' not found</code> can only be solved by editing composer.json before doing composer install (look for autoload: psr-4 ).</li>
<li>For delagent, pkgagent, mimetype issues, something can be done here: <a class="reference external" href="https://github.com/avinal/fossology/blob/avinal/feat/testing/src/testing/db/c/libfodbreposysconf.c#L349">https://github.com/avinal/fossology/blob/avinal/feat/testing/src/testing/db/c/libfodbreposysconf.c#L349</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="conclusion-and-further-plans">
<h2>Conclusion and Further Plans</h2>
<ul class="simple">
<li>Raise a pull request for all the progress till now.</li>
<li>Refactor the test source code according to suggestions.</li>
<li>Implement remaining testing configurations.</li>
</ul>
</div>

    <hr>
    <p align=center>
      This Blog is licensed under <a href="http://creativecommons.org/licenses/by-nc/4.0/?ref=chooser-v1"
        target="_blank" rel="license noopener noreferrer">Attribution-NonCommercial 4.0 International<img
          style="height:22px!important;margin-left:3px;vertical-align:text-bottom;"
          src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img
          style="height:22px!important;margin-left:3px;vertical-align:text-bottom;"
          src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img
          style="height:22px!important;margin-left:3px;vertical-align:text-bottom;"
          src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1">
      </a>
    </p>
  </div>
</article>
<div id="comment-form">
  <div class="alert alert-info" role="alert">
    Feel free to leave a feedback or questions !
  </div>
  <form action="https://docs.google.com/forms/u/0/d/e/1FAIpQLSfL9T8WBRm-Ac2uyu74lJXSYOqAuF6lLIUAulRArCsuiI1ZRQ/formResponse" target="response" method="POST" id="valid-form">
    <div class="form-row align-items-center">
      <div class="form-group col-md-5">
        <label class="sr-only" for="person-name">Name</label>
        <input type="text" class="form-control form-control-sm" id="person-name" placeholder="Your Name (Optional)"
          aria-describedby="nameHelp" name="entry.982725972">
        <input type="text" id="page-link" name="entry.1641222305" hidden>
        <small id="nameHelp" class="form-text text-muted">You may put your GitHub Username.</small>
      </div>
      <div class="form-group col-md-7">
        <label class="sr-only" for="email-address">Email address</label>
        <input type="email" class="form-control form-control-sm" id="email-address" aria-describedby="emailHelp"
          placeholder="Your Email Address (Optional)" name="entry.1652853191">
        <small id="emailHelp" class="form-text text-muted">I'll never share your email with anyone
          else.</small>
      </div>
    </div>
    <div class="form-group">
      <label class="sr-only" for="comment-section">Your Message</label>
      <textarea class="form-control form-control-sm" id="comment-section" rows="3"
        placeholder="Please enter your message or feedback. (Required)" aria-describedby="emailHelp"
        name="entry.1062656232" required></textarea>
      <div class="invalid-feedback">
        Please Enter something !
      </div>
      <small id="textHelp" class="form-text text-muted">Enter upto 200 characters.</small>
    </div>
    <button class="btn btn-outline-info" type="submit">Send</button>
  </form>
  <iframe name="response" hidden></iframe>
</div>
<div class="alert alert-info" role="alert" id="comment-message" style="display: none;">
  <h4 class="alert-heading">Thanks You 🥳</h4>
  <p>Thanks a lot for reading this blog and sending me a feedback. I hope you liked it. I will get back to you
    soon if you have added an email.</p>
</div>
<script>
  (function () {
    'use strict';
    window.addEventListener('load', function () {
      var form = document.getElementById('valid-form');
      form.addEventListener('submit', function (event) {
        document.getElementById('page-link').value = window.location.href;
        document.getElementById('comment-form').style.display = 'none';
        document.getElementById('comment-message').style.display = '';
      }, false);
    }, false);
  })();
</script>
    </div>
  </div>

  <footer class="footer star">
    <div id='stars'></div>
    <div id='stars2'></div>
    <div id='stars3'></div>
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
    <li class="list-inline-item"><a
        href="https://gsoc.avinal.space/archives.html">Archives</a></li>
    <li class="list-inline-item"><a
        href="https://gsoc.avinal.space/categories.html">Categories</a></li>
    <li class="list-inline-item"><a href="https://gsoc.avinal.space/tags.html">Tags</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    <a href="https://github.com/avinal" target="_blank">
      <img src="/images/gsoc-fossology.gif" class="img-fluid" style="max-width: 40%;">
    </a>
  </p>
</div>    </div>
  </footer>

</body>

</html>